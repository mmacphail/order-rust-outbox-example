#!/usr/bin/env bash
# .githooks/pre-commit
#
# Runs fast quality checks before every commit:
#   1. cargo fmt --check  (formatting)
#   2. cargo clippy       (lints, warnings-as-errors)
#   3. cargo test         (unit tests)
#
# End-to-end tests require Docker infrastructure and are intentionally excluded
# from this hook to keep the commit path fast. Agents and developers MUST run
# `just test-e2e` manually before opening a pull request.
#
# Install once with:  just install-hooks

set -euo pipefail

REPO_ROOT="$(git rev-parse --show-toplevel)"
cd "$REPO_ROOT"

echo "==> [pre-commit] Checking formatting..."
cargo fmt -- --check

echo "==> [pre-commit] Running clippy lints..."
cargo clippy -- -D warnings

echo "==> [pre-commit] Running unit tests..."
cargo test

echo "==> [pre-commit] All checks passed."
echo "    Remember to run 'just test-e2e' before opening a pull request."
